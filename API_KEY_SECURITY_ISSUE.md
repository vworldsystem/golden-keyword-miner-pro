# API 키 보안 문제 및 해결 방법

## ⚠️ 현재 문제점

### 문제 1: 클라이언트에 API 키 노출
- `.env.local`의 `GEMINI_API_KEY`가 빌드 시 클라이언트 번들에 포함됨
- 브라우저 개발자 도구에서 API 키 확인 가능
- 누구나 API 키를 복사해서 사용 가능

### 문제 2: 비용 부담
- 모든 사용자가 같은 API 키 사용
- 사용량이 모두 당신의 할당량에서 차감
- 사용자가 많아지면 비용 급증

### 문제 3: 사용량 제한
- Gemini API는 일일/월간 사용량 제한이 있음
- 한 사용자가 과도하게 사용하면 다른 사용자도 영향받음

## ✅ 해결 방법

### 방법 1: Firebase Functions 사용 (권장) ⭐

**장점**:
- API 키가 서버에만 존재 (클라이언트에 노출 안 됨)
- 사용량 제한 및 모니터링 가능
- 비용 관리 용이

**단점**:
- Firebase Functions 설정 필요
- 약간의 개발 시간 필요

**구현 방법**:
1. Firebase Functions에 Gemini API 호출 로직 이동
2. 클라이언트는 Functions를 호출
3. Functions에서 Gemini API 호출 후 결과 반환

### 방법 2: 사용자별 API 키 제공

**장점**:
- 각 사용자가 자신의 API 키 사용
- 비용 부담 없음

**단점**:
- 사용자가 API 키를 직접 입력해야 함
- 사용자 경험 저하
- Pro 플랜의 가치 감소

### 방법 3: 하이브리드 방식

**Free 플랜**: 사용자 자신의 API 키 사용
**Pro 플랜**: 서버에서 제공하는 API 키 사용

## 🚀 즉시 적용 가능한 해결책

### 옵션 1: Firebase Functions 구현 (1-2일)

**구조**:
```
클라이언트 → Firebase Functions → Gemini API
```

**비용**:
- Firebase Functions: 무료 티어 (월 200만 호출)
- 이후: $0.40 / 100만 호출

**장점**:
- 완전한 보안
- 사용량 제한 가능
- 비용 예측 가능

### 옵션 2: 사용량 제한 + 모니터링 (즉시 적용 가능)

**구현**:
1. Firestore에 사용량 추적
2. Free 플랜: 일일 제한 (예: 10회)
3. Pro 플랜: 더 많은 제한 (예: 100회)
4. 초과 시 경고

**장점**:
- 즉시 적용 가능
- 비용 통제

**단점**:
- API 키는 여전히 노출됨

### 옵션 3: Pro 플랜만 서버 사용 (권장)

**구조**:
- **Free 플랜**: 사용자 자신의 Gemini API 키 입력
- **Pro 플랜**: 서버의 API 키 사용 (Firebase Functions)

**장점**:
- Pro 플랜의 가치 명확
- Free 사용자는 비용 부담 없음
- Pro 사용자는 편리함

## 💡 추천 솔루션

### 단기 (지금 바로)
1. **사용량 제한 시스템 추가**
   - Free: 일일 10회
   - Pro: 일일 100회
   - Firestore로 추적

2. **API 키 경고 추가**
   - 사용자에게 API 키 사용 안내
   - Pro 플랜에서 서버 API 사용 가능하다고 안내

### 중기 (1-2주 내)
1. **Firebase Functions 구현**
   - Gemini API 호출을 서버로 이동
   - Pro 플랜 사용자만 서버 API 사용

2. **사용량 모니터링**
   - Firebase Console에서 사용량 확인
   - 비용 알림 설정

## 🔒 보안 체크리스트

### 현재 상태
- [ ] API 키가 클라이언트에 노출됨
- [ ] 사용량 제한 없음
- [ ] 비용 모니터링 없음

### 개선 후
- [ ] API 키가 서버에만 존재
- [ ] 사용량 제한 구현
- [ ] 비용 모니터링 설정
- [ ] 사용자별 사용량 추적

## 📊 비용 예상

### 현재 방식 (모든 사용자가 같은 키 사용)
- 사용자 100명, 일일 10회 사용
- 월간: 30,000회 호출
- 비용: Gemini API 가격에 따라 다름

### Firebase Functions 방식
- Functions 호출: 무료 티어 (월 200만 호출)
- Gemini API: 동일
- 추가 비용: 거의 없음 (소규모 사용 시)

## 🎯 즉시 할 수 있는 것

### 1. 사용량 제한 추가 (30분)
- Firestore에 사용량 추적
- 일일 제한 체크
- 초과 시 경고

### 2. API 키 경고 추가 (10분)
- 사용자에게 안내 메시지
- Pro 플랜에서 서버 API 사용 가능하다고 안내

### 3. Firebase Functions 준비 (1-2일)
- Functions 프로젝트 설정
- Gemini API 호출 로직 이동
- 배포

## 💬 솔직한 조언

**현재 상태로도 판매는 가능합니다**, 하지만:

1. **소규모 판매 (월 10-20명)**: 
   - 현재 방식으로도 가능
   - 사용량 제한만 추가하면 충분

2. **중규모 판매 (월 50명 이상)**:
   - Firebase Functions 필수
   - 비용 통제 필요

3. **대규모 판매 (월 100명 이상)**:
   - 반드시 서버 사이드 구현
   - 사용량 모니터링 필수

**추천**: 일단 판매를 시작하고, 사용자가 늘어나면 Firebase Functions로 전환하세요.


